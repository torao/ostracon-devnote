---
title: "共通の知り合い検索 (2013)"
emoji: "🛋️"
type: "tech" # tech: 技術記事 / idea: アイデア
topics: [ランダムサンプリング","大規模データ処理","自然言語処理","アルゴリズム"]
published: false
---

# アドレス帳から共通の知り合いを検索するには

合コンや商談のような場では、名刺交換代わりにスマートフォンをピピッと重ねるだけで共通の知り合いや共通のトピックが分かると会話の役に立つかも知れない。いや… 怪訝な面持ちになるのは分かる。だがここではグッとこらえて役に立つとしよう。

しかし共通の友人を見つけるためにアドレス帳をまるごと交換するのはプライバシーも情報保護もあったものではない。アドレス帳に載っている共通の友人のみが分かり、それ以外は相手に分からないという状況が望ましい。

## 秘匿共通集合 (PSI)

この問題は 2 つの当事者 $A$, $B$ がそれぞれ持つ集合 $S_a$, $S_b$ そのものを秘匿したままその交差となる部分集合 $S_a \cap S_b$ の要素のみを知る問題に一般化することができる。これは**秘匿共通集合** (**PSI**; Private Set Intersection) という暗号手法として知られている。

![Private Set Intersection](images/202304/psi.png)

Google Chrome や Microsoft Edge を使っていて「入力されたパスワードは漏洩しています」というような警告ダイアログを見たことはないだろうか? ブラウザの漏洩パスワード検出には PSI が使われている。この適用では、ユーザの入力したパスワードのみからなる集合 $S_1$ と、Google や Microsoft が管理している漏洩パスワードの集合 $S_2$ とが交差しているかの問題と考えることができる。このとき、PSI を使うことで、ユーザのパスワードが G や M に送られることはないし、ユーザが漏洩パスワードリストを得ることもない。

また Google のような広告配信業者 $A$ は加盟店 $B$ の広告を表示したユーザリスト $S_a$ を持っている。加盟店 $B$ は商品を購入したユーザリスト $S_b$ を持っている。そして PSI を使ってユーザリストの交差のサイズ $|S_a \cap S_b|$ を求めると、広告を表示したうちの何人が購入したか ── つまり双方のリストを秘匿したままコンバージョン率を得ることができる。

PSI の適用を提案されている例は多い。

- 病院間での同一の患者検索。
- 飲んでいる薬のリストがあり、新しい処方薬の飲み合わせの禁忌に含まれているものがあるかを検索する。

このように PSI は適用範囲が広いため盛んに研究されている。

## ナイーブハッシングによる PSI 実装

PSI は準同形暗号、秘密計算や紛失転送 (OT) など様々な暗号手法を使った提案がなされている。もっとも直感的で単純な方法は $S_a$ と $S_b$ のすべての要素をハッシュ化して交換し、ハッシュ値の一致する要素を見つける方法だろう。

$$ \left\{ \begin{array}{rcl} S'_a & = & \{h(x_a)\,|\, \forall x_a \in S_a \} \\ S'_b & = & \{h(x_b)\,|\,\forall x_b \in S_b\} \end{array} \right. \ \Rightarrow \ S'_a \cap S'_b$$

二者はそれぞれ自分の持つ集合の要素がどのようなハッシュ値に変換されたかを知っているため、共通のハッシュ値からどの要素がどのような値だったかを知ることができる。しかし共通しないハッシュ値からはいかなる情報も得られない。

… 本当に得られないのだろうか? このようなナイーブハッシングによる PSI はオフラインでの総当たり攻撃が可能である。したがって $S_i$ のエントロピーが低い場合 (つまり電話番号やメールアドレスのような要素で構成されている場合) に交差に含まれない要素を探り当てることが現実的であり脆弱である。

[^1]: NAGY, Marcin, et al. Do i know you? efficient and privacy-preserving common friend-finder protocols and applications. In: _Proceedings of the 29th Annual Computer Security Applications Conference_. 2013. p. 159-168.